
<!-- saved from url=(0206)http://watsonchatbot.epizy.com/main/main.html?msg=hello&&api=z8WUAfCBIG89N3tOBqPjC8Y15enB0ZEtNGydxl6YrSbt&&url=https://api.eu-gb.assistant.watson.cloud.ibm.com/instances/053163e0-715a-4378-b2bf-5492452e7f9a -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  margin: 0 auto;
  max-width: 360px;
  max-height: : 360px;
  padding: 0 20px;
  font-family: Arial, Helvetica, sans-serif;
  //font-family: "Arial Black", Gadget, sans-serif;
}

input[type=text] {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  box-sizing: border-box;
  border: none;
  border-bottom: 3px solid LightBlue;
  font-family: Arial, Helvetica, sans-serif;
  font-size: 16px
}

input[type=text]:focus {
  border-bottom: 6px solid MediumTurquoise;
}

/* width */
::-webkit-scrollbar {
  width: 7px;
}

/* Track */
::-webkit-scrollbar-track {
  background: white;
  box-shadow: inset 0 0 5px grey; 
  border-radius: 10px;
}
 
/* Handle */
::-webkit-scrollbar-thumb {
  background: grey; 
  border-radius: 10px;
}

/* Handle on hover */
::-webkit-scrollbar-thumb:hover {
  background: LightSlateGray; 
}

.sendButton {
  border-radius: 20px;
  height: 40px;
  background-color: DodgerBlue;
  color: white;
  border: 0px;
  font-size: 17px
}

.container {
  background-color: LightCyan;
  padding: 3px;
  padding-right:15px;
  padding-left:15px;
  margin: 8px ;
  border-radius: 8px;
  float: left;
  width: 82%;
}

.darker {
  float: right;
  background-color: #34a1eb;
  color: white;
}

.start {
  background-color: #2c62bf;
  color: white;
  text-align: center;
}

.convoWindow {
  background-image: linear-gradient(Azure, white);
  height: 360px;
  overflow: auto;
  margin-bottom: 4px;
  border-radius: 6px;
}

.time-right {
  float: right;
  color: #aaa;
}

.time-left {
  float: left;
  color: #999;
}

.chatInput {
    position: relative;
    float:left;
    height: 280px;
    width: 150px;
    }
    .imgDetails p {
        position: absolute;
        bottom: 0;
        }
</style>
</head>
<body bgcolor="white">
<div>
<font size="7" id="mainHeader">Testing chatbot</font><br>


<table style="width:100%" id="topTable">
  <tbody><tr>
    <th align="left">
      <font size="3" color="grey" id="botConnectionStatus">Status: </font><font size="3" id="botStatus" color="red" style="color: red;">Not connected</font>
    </th>
    <th align="right">
      <label id="workspacesLabel">Instance: </label><select id="workspaces">
  <option value="null">--Select workspace--</option>
<option value="a4fa373e-ef2b-4a8f-a58d-dd39b8fba4d0">Bathtub toaster</option><option value="9676c103-611f-4954-8ef7-5f304300cdad">First</option></select>
    </th>
  </tr>
</tbody></table>

  <br>



<div id="convo" class="convoWindow">




</div>

  <div class="chatInput" style="width:101%">
  <input type="text" name="text" autocomplete="off" placeholder="Please enter message here..." style="width:80%" id="inputtext">
  <button class="sendButton" type="button" onclick="getReply()" style="width:18%" id="sendBtn">Send</button>

  </div>







<script>
    var contextid;
    var input = document.getElementById("inputtext");
input.addEventListener("keyup", function(event) {
  if (event.keyCode === 13) {
   event.preventDefault();
   document.getElementById("sendBtn").click();
  }
});

  function removeElement(elementId) {
    var element = document.getElementById(elementId);
    element.parentNode.removeChild(element);
  }





var parts = window.location.search.substr(1).split("&&");
var $_GET = {};
for (var i = 0; i < parts.length; i++) {
    var temp = parts[i].split("=");
    $_GET[decodeURIComponent(temp[0])] = decodeURIComponent(temp[1]);
}
passMsg = $_GET['msg'];
passApi = $_GET['api'];
passUrl = $_GET['url'];
passWorkspace = $_GET['workspace'];
if (typeof passMsg !== 'undefined'){
  document.getElementById("inputtext").value = passMsg;
};


if (typeof passApi !== 'undefined' && typeof passUrl !== 'undefined'){
  //removeElement("login");

  if (typeof passWorkspace !== 'undefined'){
    removeElement("workspaces");
    removeElement("workspacesLabel");
    removeElement("botStatus");
    removeElement("botConnectionStatus");
    removeElement("topTable");
  } else {
    getWorkspaces();
  }
} else{
  alert('Failed to conenct: no login detail')
}


function getWorkspaces() {

  var apiValue;
  var urlValue;
  if (typeof passApi !== 'undefined' && typeof passUrl !== 'undefined'){
  apiValue = passApi;
  urlValue = passUrl;

} else {
  apiValue = document.getElementById("api").value;
  urlValue = document.getElementById("url").value;
}

  
  var url = urlValue + "/v1/workspaces?version=2019-02-28";
  var xhttp = new XMLHttpRequest();
  xhttp.open("GET", url, true);
  xhttp.setRequestHeader("Authorization", "Basic " + btoa("apikey" + ":" + apiValue))
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("botStatus").innerHTML = "ready";
      document.getElementById("botStatus").style.color = "green";

      var json = JSON.parse(this.responseText);
      var x = document.getElementById("workspaces");
      var option;
      var i;
      console.log(JSON.stringify(json.workspaces));
      for(i = 0; i < json.workspaces.length; i++){
        option = document.createElement("option");
        option.text = json.workspaces[i].name;
        option.value = json.workspaces[i].workspace_id;
        x.appendChild(option);
        document.getElementById("workspaces").selectedIndex = "1";
      }
      
   }else if (this.readyState == 4 && this.status != 200){
      alert("login failed. API-key might be wrong or ibm cloud could be down.")
    }
  };
  
  xhttp.send();
  //removeElement("login");
}


function getReply() {
  

  var apiValue;
  var urlValue;
  if (typeof passApi !== 'undefined' && typeof passUrl !== 'undefined'){
  apiValue = passApi;
  urlValue = passUrl;

} else {
  apiValue = document.getElementById("api").value;
  urlValue = document.getElementById("url").value;
}
  var e = document.getElementById("workspaces");
  var workspaceValue;
  if (typeof passWorkspace !== 'undefined'){
    workspaceValue = passWorkspace;
  } else {
    workspaceValue = e.options[e.selectedIndex].value;
  } 
  var inputtextValue = document.getElementById("inputtext").value;
  if(inputtextValue===""){return;}
  document.getElementById("inputtext").value = "";
  //var timestamp = new Date().getTime()
  document.getElementById("convo").innerHTML += '<div class="container darker"><p>'+inputtextValue+'</p></div>';
  var myDiv = document.getElementById("convo");
  myDiv.scrollTop = myDiv.scrollHeight;
  var url = urlValue + "/v1/workspaces/" + workspaceValue + "/message?version=2019-02-28";
  var xhttp = new XMLHttpRequest();
  xhttp.open("POST", url, true);
  xhttp.setRequestHeader("Content-Type", "application/json");
  xhttp.setRequestHeader("Authorization", "Basic " + btoa("apikey" + ":" + apiValue))
  var dataString;
  if (typeof contextid !== 'undefined'){
      dataString = '{"input": {"text": "'+inputtextValue+'"}, "context":  '+contextid+'}';
  } else {
      console.log("hey hey");
      dataString = '{"input": {"text": "'+inputtextValue+'"}}';
  }
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {

      var json = JSON.parse(this.responseText);
      contextid = JSON.stringify(json.context);
      document.getElementById("convo").innerHTML += '<div class="container"><p>'+json.output.text+'</p></div>';
      var myDiv = document.getElementById("convo");
      myDiv.scrollTop = myDiv.scrollHeight;
    }else if (this.readyState == 4 && this.status != 200){
      alert("login failed. API-key might be wrong or ibm cloud could be down.")
    }
  };
  //xhttp.open("POST", "https://apikey:z8WUAfCBIG89N3tOBqPjC8Y15enB0ZEtNGydxl6YrSbt@api.eu-gb.assistant.watson.cloud.ibm.com/instances/053163e0-715a-4378-b2bf-5492452e7f9a/v1/workspaces/9676c103-611f-4954-8ef7-5f304300cdad/message", true);
  console.log(dataString);
  console.log(contextid);
  xhttp.send(dataString);
}

</script>
</div>


</body></html>